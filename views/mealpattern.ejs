
<!DOCTYPE html>
<html lang="en">
  <head>
<% include ../views/links_d.ejs %>
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI Autocomplete - Default functionality</title>
  <link rel="stylesheet" href="\bootstrap-3.3.7-dist\css\autocomplete.css">
  </head>
  
  <style>

body {
    font-size: 12px;
}

table {
    background: #EAEAEA;
    overflow-x: scroll;
}



td {
	background: 	#f7f7f7;
	border : 1px solid 		#f7f7f7;
}
th {
	background : 	#3b5998;
	color: white;
	border: 0px !important
}
 
.rec>thead>tr {
	margin-top: 10px;
}



.wrapper {
    overflow-x: auto;
    width: 1500px;

}

.grpTextBox {
    width: 100%;
    height: 34px;
    padding: 6px 12px;
    font-size: 14px;
    line-height: 1.42857143;
    border: 1px solid #ccc;
    border-radius: 4px;
    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
    box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
    
}
.highlight_row td {
            background-color:#8b9dc3; 
        }


		
input:focus, select:focus { 
    background-color: rgb(255, 255, 128);
	color: black;
	border: 1px solid black;
	
}

.savebtn {
	-moz-box-shadow:inset 0px 1px 0px 0px #f5978e;
	-webkit-box-shadow:inset 0px 1px 0px 0px #f5978e;
	box-shadow:inset 0px 1px 0px 0px #f5978e;
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #f24537), color-stop(1, #c62d1f));
	background:-moz-linear-gradient(top, #f24537 5%, #c62d1f 100%);
	background:-webkit-linear-gradient(top, #f24537 5%, #c62d1f 100%);
	background:-o-linear-gradient(top, #f24537 5%, #c62d1f 100%);
	background:-ms-linear-gradient(top, #f24537 5%, #c62d1f 100%);
	background:linear-gradient(to bottom, #f24537 5%, #c62d1f 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#f24537', endColorstr='#c62d1f',GradientType=0);
	background-color:#f24537;
	-moz-border-radius:6px;
	-webkit-border-radius:6px;
	border-radius:6px;
	border:1px solid #d02718;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 6px;
	text-decoration:none;
	text-shadow:0px 1px 0px #810e05;
}
.savebtn:hover {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #c62d1f), color-stop(1, #f24537));
	background:-moz-linear-gradient(top, #c62d1f 5%, #f24537 100%);
	background:-webkit-linear-gradient(top, #c62d1f 5%, #f24537 100%);
	background:-o-linear-gradient(top, #c62d1f 5%, #f24537 100%);
	background:-ms-linear-gradient(top, #c62d1f 5%, #f24537 100%);
	background:linear-gradient(to bottom, #c62d1f 5%, #f24537 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#c62d1f', endColorstr='#f24537',GradientType=0);
	background-color:#c62d1f;
}
.savebtn:active {
	position:relative;
	top:1px;
}

.updatebtn {
	-moz-box-shadow:inset 0px 1px 0px 0px #caefab;
	-webkit-box-shadow:inset 0px 1px 0px 0px #caefab;
	box-shadow:inset 0px 1px 0px 0px #caefab;
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #77d42a), color-stop(1, #5cb811));
	background:-moz-linear-gradient(top, #77d42a 5%, #5cb811 100%);
	background:-webkit-linear-gradient(top, #77d42a 5%, #5cb811 100%);
	background:-o-linear-gradient(top, #77d42a 5%, #5cb811 100%);
	background:-ms-linear-gradient(top, #77d42a 5%, #5cb811 100%);
	background:linear-gradient(to bottom, #77d42a 5%, #5cb811 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#77d42a', endColorstr='#5cb811',GradientType=0);
	background-color:#77d42a;
	-moz-border-radius:6px;
	-webkit-border-radius:6px;
	border-radius:6px;
	border:1px solid #268a16;
	display:inline-block;
	cursor:pointer;
	color:black;
	font-family:Arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 6px;
	text-decoration:none;
	text-shadow:0px 1px 0px #aade7c;
}
.updatebtn:hover {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #5cb811), color-stop(1, #77d42a));
	background:-moz-linear-gradient(top, #5cb811 5%, #77d42a 100%);
	background:-webkit-linear-gradient(top, #5cb811 5%, #77d42a 100%);
	background:-o-linear-gradient(top, #5cb811 5%, #77d42a 100%);
	background:-ms-linear-gradient(top, #5cb811 5%, #77d42a 100%);
	background:linear-gradient(to bottom, #5cb811 5%, #77d42a 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#5cb811', endColorstr='#77d42a',GradientType=0);
	background-color:#5cb811;
}
.updatebtn:active {
	position:relative;
	top:1px;
}

.fit {
    padding-right: 0px;
    padding-left: 0px;
}

hr.hr {
    display: block;
    height: 1px;
    border: 0;
    border-top: 1px solid black;
    margin: 1em 0;
    padding: 0;
	width: 99%;
}

  </style>

  <body class="main-menu">
	
    <% include ../views/header_d.ejs %>

    <div class="container-fluid wrapper">

		<span class="pull-right"><button class="btn btn-warning" style="display:inline-block;" onclick="households()"> Households</button>
		</span>		
		<h2> Form 6.1 - Household Membership for Dietary </h2>
		<hr class="hr">
		<div class="col-md-4">	
		<h4>EACODE : <label id='eacode'></label>
		</div>
		<div class="col-md-4">	
		<h4>HCN : <label id='hcn'></label>
		</div>
		<div class="col-md-4">	
		<h4>SHSN : <label id='shsn'></label>
		</div>
	

			<h4>

			  Meal Eaten Code : <b> 0 </b>- not eaten &nbsp;&nbsp;&nbsp;<b> 1 </b>- eaten/shared in HH &nbsp;&nbsp;&nbsp;<b> 2 </b>- baon &nbsp;&nbsp;&nbsp;<b> 3 </b>- eaten out, recalled &nbsp;&nbsp;&nbsp;<b> 4 </b>- eaten out, not recalled <span class="pull-right"><h5>NOTE: Updating of data is auto-saved</h5></span></h4>
			  
			<table class="table table-striped table-bordered">
			  <br>
			  <tr>
				<th>MNO</th><th width="150px">FIRST NAME</th><th width="150px">LAST NAME</th><th>AGE</th><th>SEX</th><th>PSC</th><th>MEAL PLANNER</th>
				<th>BREAK FAST</th><th>AM_SNACK</th><th>LUNCH</th><th>PM_SNACK</th><th>SUPPER</th><th>LATE_PM_SNACK</th><th></th>
			  </tr>
				<tr>
				  <td><input type="text" class="form-control" name="MEMBER_CODE_" id="MEMBER_CODE_"/></td>
				  <td width="150px"><input type="text" class="form-control" name="GIVENNAME_" id="GIVENNAME_" /></td>
				  <td width="150px"><input type="text" class="form-control" name="SURNAME_" id="SURNAME_" /></td>
				  <td><input type="text" class="form-control" name="AGE_" id="AGE_" /></td>
				  <td><select name="SEX_" id="SEX_" class="form-control">
						<option value=''>Select Gender</option>
						<option value='1'>1 - Male</option>
						<option value='2'>2 - Female</option>
					</select> 
				  </td>
				  <td><select name="PSC_" id="PSC_" class="form-control">
					<option value=''>Select PSC</option>
					<option value='00'>0 - Non-pregnant/Non-lactating female members</option>
					<option value='01'>1 - Pregnant, 1 month</option>
					<option value='02'>2 - Pregnant, 2 months</option>
					<option value='03'>3 - Pregnant, 3 months</option>
					<option value='04'>4 - Pregnant, 4 months</option>
					<option value='05'>5 - Pregnant, 5 months</option>
					<option value='06'>6 - Pregnant, 6 months</option>
					<option value='07'>7 - Pregnant, 7 months</option>
					<option value='08'>8 - Pregnant, 8 months</option>
					<option value='09'>9 - Pregnant, 9 months</option>
					<option value='10'>10 - Lactating, 0-6 months</option>
					<option value='11'>11 - Lactating, 7-12 months</option>
					<option value='12'>12 - Lactating, over 1 year</option>
					<option value='99'>99 - Male Member</option>
				   </select>			
   				   </td>
				  <td><input type="text" class="form-control" name="MP_" id="MP_" /></td></td>
				  <td><input type="text" class="form-control" name="BF_" id="BF_" onkeypress="return event.charCode >= 48 && event.charCode <= 49" maxlength="1" /></td>
				  <td><input type="text" class="form-control" name="AMSNCK_" id="AMSNCK_" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1" /></td>
				  <td><input type="text" class="form-control" name="LUNCH_" id="LUNCH_" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1" /></td>
				  <td><input type="text" class="form-control" name="PMSNCK_" id="PMSNCK_" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1"  /></td>
				  <td><input type="text" class="form-control" name="SUPPER_" id="SUPPER_" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1" /></td>
				  <td><input type="text" class="form-control" name="LATESNCK_" id="LATESNCK_" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1" /></td>
				  <td><button class="btn btn-danger" id="insertmealpattern">Save</button></td>
				</tr>
				<% rows.forEach(function(row){
				
				var addon = row.eacode+row.hcn+row.shsn+row.MEMBER_CODE;
				%>
				<tr>
				  <td id="addon"><%=row.MEMBER_CODE%></td>
				  <td width="150px"><input type="text" class="form-control update grpTextBox" name="GIVENNAME_<%= addon%>" id="GIVENNAME_<%= addon%>" value="<%=row.GIVENNAME%>" /></td>
				  <td width="150px"><input type="text" class="form-control update grpTextBox" name="SURNAME_<%= addon%>" id="SURNAME_<%= addon%>" value="<%=row.SURNAME%>" /></td>
				  <td><input type="text" class="form-control update grpTextBox" name="AGE_<%= addon%>" id="AGE_<%= addon%>" value="<%=row.AGE%>" /></td>
				  <td><input type="text" class="form-control update grpTextBox" name="SEX_<%= addon%>" id="SEX_<%= addon%>" value="<%=row.SEX%>" /></td>
				  <td><input type="text" class="form-control update grpTextBox" name="PSC_<%= addon%>" id="PSC_<%= addon%>" value="<%=row.PSC%>" /></td>
				  <td><input type="text" class="form-control update grpTextBox" name="MP_<%= addon%>" id="MP_<%= addon%>" value="<%=row.MP%>" /></td></td>
				  <td><input type="text" class="form-control update grpTextBox" name="BF_<%= addon%>" id="BF_<%= addon%>" value="<%=row.BF%>" onkeypress="return event.charCode >= 48 && event.charCode <= 49" maxlength="1" /></td>
				  <td><input type="text" class="form-control update grpTextBox" name="AMSNCK_<%= addon%>" id="AMSNCK_<%= addon%>" value="<%=row.AMSNCK%>" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1" /></td>
				  <td><input type="text" class="form-control update grpTextBox" name="LUNCH_<%= addon%>" id="LUNCH_<%= addon%>" value="<%=row.LUNCH%>" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1" /></td>
				  <td><input type="text" class="form-control update grpTextBox" name="PMSNCK_<%= addon%>" id="PMSNCK_<%= addon%>" value="<%=row.PMSNCK%>" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1"  /></td>
				  <td><input type="text" class="form-control update grpTextBox" name="SUPPER_<%= addon%>" id="SUPPER_<%= addon%>" value="<%=row.SUPPER%>" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1" /></td>
				  <td><input type="text" class="form-control update grpTextBox" name="LATESNCK_<%= addon%>" id="LATESNCK_<%= addon%>" value="<%=row.LATESNCK%>" onkeypress="return event.charCode >= 48 && event.charCode <= 52" maxlength="1" /></td>

				</tr>
				<% }); %>
			</table>
		
		

    </div>
  
  

  <div class="container">
    <% include ../views/footer.ejs %>
  </div><!-- /container -->
  
	<script src="/jquery/jquery-ui.min.js"></script>
    <script type="text/javascript" src="/jquery/script_dietary.js"></script>


	<script type="text/javascript">
	
	$(document).ready(function (){
	
	var url = window.location.href;
    var urlArray = url.split("/");
    var bigIdString = urlArray[urlArray.length-1];
    var A = bigIdString.substring(0,12);
    var B = bigIdString.substring(12,16);
    var C = bigIdString.substring(16,20);
	
	var data= {};
    
    data.eacode = A;
    data.hcn = B;
    data.shsn = C;
	
	$('#eacode').text(A);
	$('#hcn').text(B);
	$('#shsn').text(C);
	
	$("html").bind("keypress", function(e) {
          if(e.keyCode == 13) {
            return false;
			}
			if (event.keyCode === 39 || event.keyCode === 34 || event.keyCode === 96 ) { // apostrophe, double quote, tilde
        // prevent the keypress
        return false;
    }
      });
	  
	$('#MEMBER_CODE_').focus();
    $('#MEMBER_CODE_').select();
	
	$.ajax({
                type: 'POST',
                //dataType: 'json',
                data: JSON.stringify(data),
                    contentType: 'application/json',
                            url: '/mealpattern',						
                            success: function(data) {
							
							<!-- var input = JSON.parse(JSON.stringify(data)); -->
                               <!-- Object.keys(input).forEach(function(key) { -->
                               <!-- var val = input[key]; -->
                               <!-- var view = '"+req.body.'+key+'+", '; -->
                               <!-- console.log(view); -->
                       
                                <!-- }); -->
							
							}
							
			});
	
	
	  
	$(document).on('click', '#insertmealpattern', function() {
		var data = {};
		data.eacode = A;
		data.hcn = B;
		data.shsn = C;
		data.MEMBER_CODE = $('#MEMBER_CODE_').val();
		data.MP = $('#MP_').val();
		data.SURNAME = $('#SURNAME_').val();
		data.GIVENNAME = $('#GIVENNAME_').val();
		data.AGE = $('#AGE_').val();
		data.SEX = $('#SEX_').val();
		data.PSC = $('#PSC_').val();
		data.BF = $('#BF_').val();
		data.AMSNCK = $('#AMSNCK_').val();
		data.LUNCH = $('#LUNCH_').val();
		data.PMSNCK = $('#PMSNCK_').val();
		data.SUPPER = $('#SUPPER_').val();
		data.LATESNCK = $('#LATESNCK_').val();
		
		if(data.MEMBER_CODE.length !=2) {
		alert('MEMBER_CODE should be two characters \nexample: 05, 19, 18');
		}
		else if(data.AGE ==0) {
		alert('AGE should be greater than zero \nexample:\n 3 days old is equal to 3/365 = 0.0082 yrs old\n 8 months old is equal to 8/12 = 0.6667 yrs old \n 4 months and 10days is equal to (4/12)+(10/365) = 0.3674 yrs old \n\n Reminders : Please take note if the year is a leap year. ');
		}
		else {
		$.ajax({
                type: 'POST',
                //dataType: 'json',
                data: JSON.stringify(data),
                    contentType: 'application/json',
                            url: '/insertmealpattern',						
                            success: function(data) {
							
							if(data == 'error') {
							alert('existing MEMBER_CODE');
							return false;
							}
							
							if(data == 'err') {
							alert('same line #, pls check');
							return false;
							<!-- window.location.href = '/mealpattern/'+A+B+C; -->
							}
							else {
							 window.location.href = '/mealpattern/'+A+B+C;
							}
							
							}
	
		});
		}
		 
		});
		
		$(document).on('keyup', '.update', function() {
    // save user answer on key press
    update($(this));

	});

	function update(answer) {
    // store user answer to the database
    var data = {};

    var name = answer.attr('name');
    var value = answer.val();
	var name2 = name.split('_');
    data.name = name2[0];
    data.value = value;

    var url = window.location.href;
    var id = url.split('/').pop();
    data.eacode = A;
    data.hcn = B;
    data.shsn = C;
	data.MEMBER_CODE = name.substring(name.length-2);

    $.ajax({
        type: 'POST',
        data: JSON.stringify(data),
        contentType: 'application/json',
        url: '/updatemealpattern',
        success: function(data) {
          // console.log(data);
        }
    });

	}
	  
	});

	$('input, button, select').keyup(function (e) {
		if (e.shiftKey) {
				if (e.which == 39)
					$(this).closest('td').next().find('input, button, select').focus();
				else if (e.which == 37)
					$(this).closest('td').prev().find('input, button, select').focus();
				else if (e.which == 40)
					$(this).closest('tr').next().find('td:eq(' + $(this).closest('td').index() + ')').find('input, button, select').focus();
				else if (e.which == 38)
					$(this).closest('tr').prev().find('td:eq(' + $(this).closest('td').index() + ')').find('input, button, select').focus();
			}
    });
	
	
		
		$('.grpTextBox').focus(function() {
        $(this).closest('tr').addClass('highlight_row');
		});
		$('.grpTextBox').blur(function() {
			$(this).closest('tr').removeClass('highlight_row');
		});
		
	
	
	
	</script>

  </body>
</html>
